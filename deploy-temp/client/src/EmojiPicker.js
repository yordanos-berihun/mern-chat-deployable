import React, { useState, useCallback, useMemo } from 'react';
import './EmojiPicker.css';

const EMOJI_DATA = {
  smileys: ['ðŸ˜€','ðŸ˜ƒ','ðŸ˜„','ðŸ˜','ðŸ˜†','ðŸ˜…','ðŸ¤£','ðŸ˜‚','ðŸ™‚','ðŸ™ƒ','ðŸ˜‰','ðŸ˜Š','ðŸ˜‡','ðŸ¥°','ðŸ˜','ðŸ¤©','ðŸ˜˜','ðŸ˜—','ðŸ˜š','ðŸ˜™','ðŸ¥²','ðŸ˜‹','ðŸ˜›','ðŸ˜œ','ðŸ¤ª','ðŸ˜','ðŸ¤‘','ðŸ¤—','ðŸ¤­','ðŸ¤«','ðŸ¤”','ðŸ¤','ðŸ¤¨','ðŸ˜','ðŸ˜‘','ðŸ˜¶','ðŸ˜','ðŸ˜’','ðŸ™„','ðŸ˜¬','ðŸ¤¥','ðŸ˜Œ','ðŸ˜”','ðŸ˜ª','ðŸ¤¤','ðŸ˜´','ðŸ˜·','ðŸ¤’','ðŸ¤•','ðŸ¤¢','ðŸ¤®','ðŸ¤§','ðŸ¥µ','ðŸ¥¶','ðŸ¥´','ðŸ˜µ','ðŸ¤¯','ðŸ¤ ','ðŸ¥³','ðŸ¥¸','ðŸ˜Ž','ðŸ¤“','ðŸ§'],
  gestures: ['ðŸ‘‹','ðŸ¤š','ðŸ–','âœ‹','ðŸ––','ðŸ‘Œ','ðŸ¤Œ','ðŸ¤','âœŒ','ðŸ¤ž','ðŸ¤Ÿ','ðŸ¤˜','ðŸ¤™','ðŸ‘ˆ','ðŸ‘‰','ðŸ‘†','ðŸ–•','ðŸ‘‡','â˜','ðŸ‘','ðŸ‘Ž','âœŠ','ðŸ‘Š','ðŸ¤›','ðŸ¤œ','ðŸ‘','ðŸ™Œ','ðŸ‘','ðŸ¤²','ðŸ¤','ðŸ™','âœ','ðŸ’…','ðŸ¤³','ðŸ’ª','ðŸ¦¾','ðŸ¦¿','ðŸ¦µ','ðŸ¦¶','ðŸ‘‚','ðŸ¦»','ðŸ‘ƒ','ðŸ§ ','ðŸ«€','ðŸ«','ðŸ¦·','ðŸ¦´','ðŸ‘€','ðŸ‘','ðŸ‘…','ðŸ‘„','ðŸ’‹'],
  animals: ['ðŸ¶','ðŸ±','ðŸ­','ðŸ¹','ðŸ°','ðŸ¦Š','ðŸ»','ðŸ¼','ðŸ¨','ðŸ¯','ðŸ¦','ðŸ®','ðŸ·','ðŸ½','ðŸ¸','ðŸµ','ðŸ™ˆ','ðŸ™‰','ðŸ™Š','ðŸ’','ðŸ”','ðŸ§','ðŸ¦','ðŸ¤','ðŸ£','ðŸ¥','ðŸ¦†','ðŸ¦…','ðŸ¦‰','ðŸ¦‡','ðŸº','ðŸ—','ðŸ´','ðŸ¦„','ðŸ','ðŸ›','ðŸ¦‹','ðŸŒ','ðŸž','ðŸœ','ðŸ¦Ÿ','ðŸ¦—','ðŸ•·','ðŸ•¸','ðŸ¦‚','ðŸ¢','ðŸ','ðŸ¦Ž','ðŸ¦–','ðŸ¦•','ðŸ™','ðŸ¦‘','ðŸ¦','ðŸ¦ž','ðŸ¦€','ðŸ¡','ðŸ ','ðŸŸ','ðŸ¬','ðŸ³','ðŸ‹','ðŸ¦ˆ','ðŸŠ','ðŸ…','ðŸ†','ðŸ¦“','ðŸ¦','ðŸ¦§','ðŸ˜','ðŸ¦›','ðŸ¦','ðŸª','ðŸ«','ðŸ¦’','ðŸ¦˜','ðŸƒ','ðŸ‚','ðŸ„','ðŸŽ','ðŸ–','ðŸ','ðŸ‘','ðŸ¦™','ðŸ','ðŸ¦Œ','ðŸ•','ðŸ©','ðŸ¦®','ðŸ•â€ðŸ¦º','ðŸˆ','ðŸ“','ðŸ¦ƒ','ðŸ¦š','ðŸ¦œ','ðŸ¦¢','ðŸ¦©','ðŸ•Š','ðŸ‡','ðŸ¦','ðŸ¦¨','ðŸ¦¡','ðŸ¦¦','ðŸ¦¥','ðŸ','ðŸ€','ðŸ¿','ðŸ¦”'],
  food: ['ðŸ','ðŸŽ','ðŸ','ðŸŠ','ðŸ‹','ðŸŒ','ðŸ‰','ðŸ‡','ðŸ“','ðŸ«','ðŸˆ','ðŸ’','ðŸ‘','ðŸ¥­','ðŸ','ðŸ¥¥','ðŸ¥','ðŸ…','ðŸ†','ðŸ¥‘','ðŸ¥¦','ðŸ¥¬','ðŸ¥’','ðŸŒ¶','ðŸ«‘','ðŸŒ½','ðŸ¥•','ðŸ«’','ðŸ§„','ðŸ§…','ðŸ¥”','ðŸ ','ðŸ¥','ðŸ¥¯','ðŸž','ðŸ¥–','ðŸ¥¨','ðŸ§€','ðŸ¥š','ðŸ³','ðŸ§ˆ','ðŸ¥ž','ðŸ§‡','ðŸ¥“','ðŸ¥©','ðŸ—','ðŸ–','ðŸ¦´','ðŸŒ­','ðŸ”','ðŸŸ','ðŸ•','ðŸ«“','ðŸ¥ª','ðŸ¥™','ðŸ§†','ðŸŒ®','ðŸŒ¯','ðŸ«”','ðŸ¥—','ðŸ¥˜','ðŸ«•','ðŸ¥«','ðŸ','ðŸœ','ðŸ²','ðŸ›','ðŸ£','ðŸ±','ðŸ¥Ÿ','ðŸ¦ª','ðŸ¤','ðŸ™','ðŸš','ðŸ˜','ðŸ¥','ðŸ¥ ','ðŸ¥®','ðŸ¢','ðŸ¡','ðŸ§','ðŸ¨','ðŸ¦','ðŸ¥§','ðŸ§','ðŸ°','ðŸŽ‚','ðŸ®','ðŸ­','ðŸ¬','ðŸ«','ðŸ¿','ðŸ©','ðŸª','ðŸŒ°','ðŸ¥œ','ðŸ¯'],
  activities: ['âš½','ðŸ€','ðŸˆ','âš¾','ðŸ¥Ž','ðŸŽ¾','ðŸ','ðŸ‰','ðŸ¥','ðŸŽ±','ðŸª€','ðŸ“','ðŸ¸','ðŸ’','ðŸ‘','ðŸ¥','ðŸ','ðŸ¥…','â›³','ðŸª','ðŸ¹','ðŸŽ£','ðŸ¤¿','ðŸ¥Š','ðŸ¥‹','ðŸŽ½','ðŸ›¹','ðŸ›¼','ðŸ›·','â›¸','ðŸ¥Œ','ðŸŽ¿','â›·','ðŸ‚','ðŸª‚','ðŸ‹','ðŸ¤¼','ðŸ¤¸','ðŸ¤º','ðŸ¤¾','ðŸŒ','ðŸ‡','ðŸ§˜','ðŸ„','ðŸŠ','ðŸ¤½','ðŸš£','ðŸ§—','ðŸšµ','ðŸš´','ðŸ†','ðŸ¥‡','ðŸ¥ˆ','ðŸ¥‰','ðŸ…','ðŸŽ–','ðŸµ','ðŸŽ—','ðŸŽ«','ðŸŽŸ','ðŸŽª','ðŸ¤¹','ðŸŽ­','ðŸ©°','ðŸŽ¨','ðŸŽ¬','ðŸŽ¤','ðŸŽ§','ðŸŽ¼','ðŸŽ¹','ðŸ¥','ðŸª˜','ðŸŽ·','ðŸŽº','ðŸª—','ðŸŽ¸','ðŸª•','ðŸŽ»','ðŸŽ²','â™Ÿ','ðŸŽ¯','ðŸŽ³','ðŸŽ®','ðŸŽ°','ðŸ§©'],
  travel: ['ðŸš—','ðŸš•','ðŸš™','ðŸšŒ','ðŸšŽ','ðŸŽ','ðŸš“','ðŸš‘','ðŸš’','ðŸš','ðŸ›»','ðŸšš','ðŸš›','ðŸšœ','ðŸ¦¯','ðŸ¦½','ðŸ¦¼','ðŸ›´','ðŸš²','ðŸ›µ','ðŸ','ðŸ›º','ðŸš¨','ðŸš”','ðŸš','ðŸš˜','ðŸš–','ðŸš¡','ðŸš ','ðŸšŸ','ðŸšƒ','ðŸš‹','ðŸšž','ðŸš','ðŸš„','ðŸš…','ðŸšˆ','ðŸš‚','ðŸš†','ðŸš‡','ðŸšŠ','ðŸš‰','âœˆ','ðŸ›«','ðŸ›¬','ðŸ›©','ðŸ’º','ðŸ›°','ðŸš€','ðŸ›¸','ðŸš','ðŸ›¶','â›µ','ðŸš¤','ðŸ›¥','ðŸ›³','â›´','ðŸš¢','âš“','â›½','ðŸš§','ðŸš¦','ðŸš¥','ðŸš','ðŸ—º','ðŸ—¿','ðŸ—½','ðŸ—¼','ðŸ°','ðŸ¯','ðŸŸ','ðŸŽ¡','ðŸŽ¢','ðŸŽ ','â›²','â›±','ðŸ–','ðŸ','ðŸœ','ðŸŒ‹','â›°','ðŸ”','ðŸ—»','ðŸ•','â›º','ðŸ›–','ðŸ ','ðŸ¡','ðŸ˜','ðŸš','ðŸ—','ðŸ­','ðŸ¢','ðŸ¬','ðŸ£','ðŸ¤','ðŸ¥','ðŸ¦','ðŸ¨','ðŸª','ðŸ«','ðŸ©','ðŸ’’','ðŸ›','â›ª','ðŸ•Œ','ðŸ•','ðŸ›•','ðŸ•‹','â›©','ðŸ›¤','ðŸ›£'],
  objects: ['âŒš','ðŸ“±','ðŸ“²','ðŸ’»','âŒ¨','ðŸ–¥','ðŸ–¨','ðŸ–±','ðŸ–²','ðŸ•¹','ðŸ—œ','ðŸ’¾','ðŸ’¿','ðŸ“€','ðŸ“¼','ðŸ“·','ðŸ“¸','ðŸ“¹','ðŸŽ¥','ðŸ“½','ðŸŽž','ðŸ“ž','â˜Ž','ðŸ“Ÿ','ðŸ“ ','ðŸ“º','ðŸ“»','ðŸŽ™','ðŸŽš','ðŸŽ›','ðŸ§­','â±','â²','â°','ðŸ•°','âŒ›','â³','ðŸ“¡','ðŸ”‹','ðŸ”Œ','ðŸ’¡','ðŸ”¦','ðŸ•¯','ðŸª”','ðŸ§¯','ðŸ›¢','ðŸ’¸','ðŸ’µ','ðŸ’´','ðŸ’¶','ðŸ’·','ðŸª™','ðŸ’°','ðŸ’³','ðŸ’Ž','âš–','ðŸªœ','ðŸ§°','ðŸª›','ðŸ”§','ðŸ”¨','âš’','ðŸ› ','â›','ðŸªš','ðŸ”©','âš™','ðŸª¤','ðŸ§±','â›“','ðŸ§²','ðŸ”«','ðŸ’£','ðŸ§¨','ðŸª“','ðŸ”ª','ðŸ—¡','âš”','ðŸ›¡','ðŸš¬','âš°','ðŸª¦','âš±','ðŸº','ðŸ”®','ðŸ“¿','ðŸ§¿','ðŸ’ˆ','âš—','ðŸ”­','ðŸ”¬','ðŸ•³','ðŸ©¹','ðŸ©º','ðŸ’Š','ðŸ’‰','ðŸ©¸','ðŸ§¬','ðŸ¦ ','ðŸ§«','ðŸ§ª','ðŸŒ¡','ðŸ§¹','ðŸª ','ðŸ§º','ðŸ§»','ðŸš½','ðŸš°','ðŸš¿','ðŸ›','ðŸ›€','ðŸ§¼','ðŸª¥','ðŸª’','ðŸ§½','ðŸª£','ðŸ§´','ðŸ›Ž','ðŸ”‘','ðŸ—','ðŸšª','ðŸª‘','ðŸ›‹','ðŸ›','ðŸ›Œ','ðŸ§¸','ðŸª†','ðŸ–¼','ðŸªž','ðŸªŸ','ðŸ›','ðŸ›’','ðŸŽ','ðŸŽˆ','ðŸŽ','ðŸŽ€','ðŸª„','ðŸª…','ðŸŽŠ','ðŸŽ‰','ðŸŽŽ','ðŸ®','ðŸŽ','ðŸ§§','âœ‰','ðŸ“©','ðŸ“¨','ðŸ“§','ðŸ’Œ','ðŸ“¥','ðŸ“¤','ðŸ“¦','ðŸ·','ðŸª§','ðŸ“ª','ðŸ“«','ðŸ“¬','ðŸ“­','ðŸ“®','ðŸ“¯','ðŸ“œ','ðŸ“ƒ','ðŸ“„','ðŸ“‘','ðŸ“Š','ðŸ“ˆ','ðŸ“‰','ðŸ—’','ðŸ—“','ðŸ“†','ðŸ“…','ðŸ—‘','ðŸ“‡','ðŸ—ƒ','ðŸ—³','ðŸ—„','ðŸ“‹','ðŸ“','ðŸ“‚','ðŸ—‚','ðŸ—ž','ðŸ“°','ðŸ““','ðŸ“”','ðŸ“’','ðŸ“•','ðŸ“—','ðŸ“˜','ðŸ“™','ðŸ“š','ðŸ“–','ðŸ”–','ðŸ§·','ðŸ”—','ðŸ“Ž','ðŸ–‡','ðŸ“','ðŸ“','ðŸ§®','ðŸ“Œ','ðŸ“','âœ‚','ðŸ–Š','ðŸ–‹','âœ’','ðŸ–Œ','ðŸ–','ðŸ“','âœ','ðŸ”','ðŸ”Ž','ðŸ”','ðŸ”','ðŸ”’','ðŸ”“']
};

const EmojiPicker = ({ onEmojiSelect, onClose }) => {
  const [activeCategory, setActiveCategory] = useState('smileys');
  const [searchQuery, setSearchQuery] = useState('');
  const [recentEmojis, setRecentEmojis] = useState(() => {
    const saved = localStorage.getItem('recentEmojis');
    return saved ? JSON.parse(saved) : [];
  });

  const categories = [
    { id: 'recent', label: 'ðŸ•’', name: 'Recent' },
    { id: 'smileys', label: 'ðŸ˜€', name: 'Smileys' },
    { id: 'gestures', label: 'ðŸ‘‹', name: 'Gestures' },
    { id: 'animals', label: 'ðŸ¶', name: 'Animals' },
    { id: 'food', label: 'ðŸ•', name: 'Food' },
    { id: 'activities', label: 'âš½', name: 'Activities' },
    { id: 'travel', label: 'âœˆï¸', name: 'Travel' },
    { id: 'objects', label: 'ðŸ’¡', name: 'Objects' }
  ];

  const filteredEmojis = useMemo(() => {
    if (activeCategory === 'recent') return recentEmojis;
    if (searchQuery) {
      return Object.values(EMOJI_DATA).flat().filter(emoji => 
        emoji.includes(searchQuery)
      );
    }
    return EMOJI_DATA[activeCategory] || [];
  }, [activeCategory, searchQuery, recentEmojis]);

  const handleEmojiClick = useCallback((emoji) => {
    onEmojiSelect(emoji);
    
    const updated = [emoji, ...recentEmojis.filter(e => e !== emoji)].slice(0, 24);
    setRecentEmojis(updated);
    localStorage.setItem('recentEmojis', JSON.stringify(updated));
  }, [onEmojiSelect, recentEmojis]);

  return (
    <div className="emoji-picker">
      <div className="emoji-picker-header">
        <input
          type="text"
          placeholder="Search emoji..."
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
          className="emoji-search"
        />
        <button onClick={onClose} className="emoji-close">Ã—</button>
      </div>

      <div className="emoji-categories">
        {categories.map(cat => (
          <button
            key={cat.id}
            className={`emoji-category-btn ${activeCategory === cat.id ? 'active' : ''}`}
            onClick={() => {
              setActiveCategory(cat.id);
              setSearchQuery('');
            }}
            title={cat.name}
          >
            {cat.label}
          </button>
        ))}
      </div>

      <div className="emoji-grid">
        {filteredEmojis.length > 0 ? (
          filteredEmojis.map((emoji, idx) => (
            <button
              key={`${emoji}-${idx}`}
              className="emoji-item"
              onClick={() => handleEmojiClick(emoji)}
            >
              {emoji}
            </button>
          ))
        ) : (
          <div className="emoji-empty">
            {activeCategory === 'recent' ? 'No recent emojis' : 'No emojis found'}
          </div>
        )}
      </div>
    </div>
  );
};

export default EmojiPicker;
